os: windows
language: shell

env:
  global:
    - GOVERSION: 1.11.5
    - NODEJS_VERSION: 11.9.0

before_install:
  - git clone https://github.com/portapps/portapps ${TRAVIS_BUILD_DIR}/../portapps
  - source ${TRAVIS_BUILD_DIR}/../portapps/.travis/prepare.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/java.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/ant.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/nodejs.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/go.sh
  - set

script:
  - ant release

after_success:
  - export APP_VERSION=$(cat $TRAVIS_BUILD_DIR/bin/tmp/version.dat)
  - echo ${APP_VERSION}

before_deploy:
  - git config --local user.email "builds@travis-ci.com"
  - git config --local user.name "Travis CI"
  - export TRAVIS_TAG="${APP_VERSION}"
  - git tag $TRAVIS_TAG
  - ls -al bin/release

deploy:
  provider: releases
  api_key:
    secure: ltOVFW/sCLxuQMYGVHtUOlCiSedw37+sT0jvYP9W1jlQBE9hVv/vrHQq3RSOn+j1r/MdVyICuqIDV5zbCOim+ESSbvH0eW1J0ypE4V25wwEBc45vXHGN+d/LMr/4rcdyMVAi2haDwxwBYGbIRZQuwUscOOCZ77LNgeo6JG66F+CEy3UxJufVpMDfQ1xbcFC1/EK2kGuTjyg7d3L6fE9WiBoTJrZVD/AlYfn7f8mFdcJjefmuF7qh6D2br8vuFy/ne+3OFUr7PLz4/Kq7EIfzRYE+tynC1sXn2n/OQ+17dqY3+HI2EuA7N6y3T5FNfTpZsOGuz8MBANkZTmDE5qZvXFT5Yqj/3Jl3fDZEAHCv+33N5VByPqW5ksJnW/svpPh89XutAVb6JFbjvuVde+dtTV8Kt3mBzrqiNXTrJ5klGnXr9Ul6bjyd+/BlZxAIPb5vK6xH4q31z6PNqHgLf6WOcH4/LaudMGyui0XQqWNMg2zSU02R+vLbkThMB1WJam+/HoE7XnXYxPXpZf6mnKhjQ2aN5FnG/KzR3Cyprhh7PMcTyGvuXa3SshkbViJIy6EnaUjq2BIG1QKFMMk7mAMPveumWNEk7G4WjcLlaJPa8m59MZnQAFikOG27SmRiW0m2i7KKrlVIQBp2JNQfFZzjW0kdsw1U5jFy3jD8mSbNDYE=
  file_glob: true
  file: bin/release/*
  skip_cleanup: true
  draft: true
  on:
    tags: false

notifications:
  email:
    recipients:
      - travisci@portapps.io
    on_success: always
    on_failure: always
